# –ó–≤—ñ—Ç –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è Block 3, –ø—É–Ω–∫—Ç 5

## –ó–∞–≤–¥–∞–Ω–Ω—è
**5. –û–±–º–µ–∂–µ–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è**

---

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ

### üì¶ 5.1. SQL –æ–±–º–µ–∂–µ–Ω–Ω—è

#### 1. ‚úÖ –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –ª—ñ—Ü–µ–Ω–∑—ñ–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –ª—ñ–∫–∞—Ä—è

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor`

```python
_sql_constraints = [
    ('license_number_unique',
     'UNIQUE(license_number)',
     'License number must be unique!'),
]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ INSERT/UPDATE
- –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑ –∑–∞–ø–∏—Ç—É –¥–æ Python

---

#### 2. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥—É –ª—ñ–∫–∞—Ä—è (0.00 <= —Ä–µ–π—Ç–∏–Ω–≥ <= 5.00)

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor`

```python
_sql_constraints = [
    ('rating_check',
     'CHECK(rating >= 0.00 AND rating <= 5.00)',
     'Rating must be between 0.00 and 5.00!'),
]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î
- –î—ñ–∞–ø–∞–∑–æ–Ω: 0.00 - 5.00
- –ù–µ–º–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è

---

#### 3. ‚úÖ –ß–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è > —á–∞—Å –ø–æ—á–∞—Ç–∫—É –≤ —Ä–æ–∑–∫–ª–∞–¥—ñ –ª—ñ–∫–∞—Ä—è

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor.schedule`

```python
_sql_constraints = [
    ('time_check',
     'CHECK(time_to > time_from)',
     'End time must be later than start time!'),
]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î
- –ì–∞—Ä–∞–Ω—Ç—É—î –ª–æ–≥—ñ—á–Ω—ñ—Å—Ç—å —Ä–æ–∑–∫–ª–∞–¥—É
- –ù–µ –¥–æ–∑–≤–æ–ª—è—î –Ω—É–ª—å–æ–≤—É –∞–±–æ –≤—ñ–¥'—î–º–Ω—É —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å

---

### üêç 5.2. Python –æ–±–º–µ–∂–µ–Ω–Ω—è (@api.constrains)

#### 1. ‚úÖ –ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–±–æ—Ä—É —ñ–Ω—Ç–µ—Ä–Ω–∞ —è–∫ –ª—ñ–∫–∞—Ä—è-–º–µ–Ω—Ç–æ—Ä–∞

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor`

```python
@api.constrains('mentor_id', 'is_intern')
def _check_mentor(self):
    """–í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–∏–±–æ—Ä—É –º–µ–Ω—Ç–æ—Ä–∞"""
    for record in self:
        # –Ü–Ω—Ç–µ—Ä–Ω –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—Ç–æ—Ä–æ–º
        if record.mentor_id and record.mentor_id.is_intern:
            raise ValidationError(
                _('An intern cannot be a mentor!')
            )
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç—É—Å –º–µ–Ω—Ç–æ—Ä–∞
- –¢—ñ–ª—å–∫–∏ –∑–≤–∏—á–∞–π–Ω—ñ (–Ω–µ-—ñ–Ω—Ç–µ—Ä–Ω–∏) –ª—ñ–∫–∞—Ä—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –º–µ–Ω—Ç–æ—Ä–∞–º–∏
- –ó–∞–ø–æ–±—ñ–≥–∞—î –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–º –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º

---

#### 2. ‚úÖ –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–∞–ø–∏—Å—É –æ–¥–Ω–æ–≥–æ –ø–∞—Ü—ñ—î–Ω—Ç–∞ –¥–æ –æ–¥–Ω–æ–≥–æ –ª—ñ–∫–∞—Ä—è –±—ñ–ª—å—à–µ —Ä–∞–∑—É –Ω–∞ –¥–µ–Ω—å

**–ú–æ–¥–µ–ª—å:** `hr.hospital.visit`

```python
@api.constrains('patient_id', 'doctor_id', 'scheduled_date')
def _check_duplicate_visit(self):
    """
    –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–∞–ø–∏—Å—É –æ–¥–Ω–æ–≥–æ –ø–∞—Ü—ñ—î–Ω—Ç–∞ –¥–æ –æ–¥–Ω–æ–≥–æ –ª—ñ–∫–∞—Ä—è
    –±—ñ–ª—å—à–µ —Ä–∞–∑—É –Ω–∞ –¥–µ–Ω—å
    """
    for record in self:
        if (record.patient_id and record.doctor_id and
                record.scheduled_date):
            visit_date = fields.Date.to_date(record.scheduled_date)
            
            domain = [
                ('id', '!=', record.id),
                ('patient_id', '=', record.patient_id.id),
                ('doctor_id', '=', record.doctor_id.id),
                ('scheduled_date', '>=', ...),  # –ø–æ—á–∞—Ç–æ–∫ –¥–Ω—è
                ('scheduled_date', '<', ...),   # –∫—ñ–Ω–µ—Ü—å –¥–Ω—è
                ('status', '!=', 'cancelled'),
            ]
            
            duplicate = self.search(domain, limit=1)
            if duplicate:
                raise ValidationError(...)
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –≤—Å—ñ –≤—ñ–∑–∏—Ç–∏ –≤ –º–µ–∂–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–Ω—è
- –Ü–≥–Ω–æ—Ä—É—î —Å–∫–∞—Å–æ–≤–∞–Ω—ñ –≤—ñ–∑–∏—Ç–∏
- –î–∞—î –¥–µ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç

---

#### 3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ –ª—ñ–∫–∞—Ä –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—Ç–æ—Ä–æ–º —Å–∞–º–æ–º—É —Å–æ–±—ñ

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor`

```python
@api.constrains('mentor_id', 'is_intern')
def _check_mentor(self):
    for record in self:
        # –õ—ñ–∫–∞—Ä –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—Ç–æ—Ä–æ–º —Å–∞–º —Å–æ–±—ñ
        if record.mentor_id and record.mentor_id.id == record.id:
            raise ValidationError(
                _('A doctor cannot be their own mentor!')
            )
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ó–∞–ø–æ–±—ñ–≥–∞—î —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î ID –∑–∞–ø–∏—Å—ñ–≤
- –ß—ñ—Ç–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É

---

#### 4. ‚úÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

**–ú–æ–¥–µ–ª—å:** `hr.hospital.diagnosis`

```python
@api.constrains('approval_date', 'visit_id')
def _check_approval_date(self):
    """–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞—Ç–∏ –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥—ñ–∞–≥–Ω–æ–∑—É"""
    for record in self:
        if record.approval_date and record.visit_id:
            visit_date = record.visit_id.scheduled_date
            if visit_date and record.approval_date < visit_date:
                raise ValidationError(
                    _('Approval date cannot be earlier than visit date!')
                )
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —â–æ –¥—ñ–∞–≥–Ω–æ–∑ –Ω–µ –∑–∞—Ç–≤–µ—Ä–¥–∂—É—î—Ç—å—Å—è –¥–æ –≤—ñ–∑–∏—Ç—É
- –õ–æ–≥—ñ—á–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø–æ–¥—ñ–π
- –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö –≤—ñ–¥ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è

---

#### 5. ‚úÖ –í—ñ–∫ –ø–∞—Ü—ñ—î–Ω—Ç–∞ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0

**–ú–æ–¥–µ–ª—å:** `hr.hospital.patient`

```python
@api.constrains('date_of_birth')
def _check_date_of_birth(self):
    """–í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—ñ–∫—É –ø–∞—Ü—ñ—î–Ω—Ç–∞"""
    for record in self:
        if record.date_of_birth:
            if record.date_of_birth > fields.Date.today():
                raise ValidationError(
                    _('Date of birth cannot be in the future!')
                )
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —â–æ –≤—ñ–∫ –±—ñ–ª—å—à–µ 0
            if record.date_of_birth == fields.Date.today():
                raise ValidationError(
                    _('Patient age must be greater than 0!')
                )
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É
- –ü–∞—Ü—ñ—î–Ω—Ç –º–∞—î –±—É—Ç–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω–∏–π –º—ñ–Ω—ñ–º—É–º –≤—á–æ—Ä–∞
- –í—ñ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —è–∫ computed –ø–æ–ª–µ

---

### üîí 5.3. –û–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è

#### 1. ‚úÖ –ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–∑–∏—Ç—ñ–≤ –∑ –¥—ñ–∞–≥–Ω–æ–∑–∞–º–∏

**–ú–æ–¥–µ–ª—å:** `hr.hospital.visit`

```python
def unlink(self):
    """–ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–∑–∏—Ç—ñ–≤ –∑ –¥—ñ–∞–≥–Ω–æ–∑–∞–º–∏"""
    for record in self:
        if record.diagnosis_ids:
            raise ValidationError(
                _('Cannot delete visit with diagnoses! '
                  'Please remove diagnoses first.')
            )
    return super().unlink()
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- Override –º–µ—Ç–æ–¥—É unlink()
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥—ñ–∞–≥–Ω–æ–∑—ñ–≤
- –í–∏–º–∞–≥–∞—î —Å–ø–æ—á–∞—Ç–∫—É –≤–∏–¥–∞–ª–∏—Ç–∏ –¥—ñ–∞–≥–Ω–æ–∑–∏
- –ó–∞—Ö–∏—Å—Ç –º–µ–¥–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö

---

#### 2. ‚úÖ –ó–∞–±–æ—Ä–æ–Ω–∞ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è –ª—ñ–∫–∞—Ä—ñ–≤ –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ –≤—ñ–∑–∏—Ç–∞–º–∏

**–ú–æ–¥–µ–ª—å:** `hr.hospital.doctor`

```python
@api.constrains('active')
def _check_archive_with_active_visits(self):
    """–ó–∞–±–æ—Ä–æ–Ω–∞ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è –ª—ñ–∫–∞—Ä—ñ–≤ –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ –≤—ñ–∑–∏—Ç–∞–º–∏"""
    for record in self:
        if not record.active:
            active_visits = self.env['hr.hospital.visit'].search([
                ('doctor_id', '=', record.id),
                ('scheduled_date', '>=', fields.Date.today()),
            ], limit=1)
            if active_visits:
                raise ValidationError(
                    _('Cannot archive doctor with active visits! '
                      'Please reassign or cancel visits first.')
                )
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –°–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—ñ (active=False)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –º–∞–π–±—É—Ç–Ω—ñ –≤—ñ–∑–∏—Ç–∏
- –í–∏–º–∞–≥–∞—î –ø–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–±–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –≤—ñ–∑–∏—Ç—ñ–≤
- –ó–∞—Ö–∏—Å—Ç –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ –≤—ñ–¥ –≤—Ç—Ä–∞—Ç–∏ –ª—ñ–∫–∞—Ä—è

---

#### 3. ‚úÖ –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–º—ñ–Ω–∏ –ª—ñ–∫–∞—Ä—è/–¥–∞—Ç–∏/—á–∞—Å—É –≤—ñ–∑–∏—Ç—É —â–æ –≤–∂–µ –≤—ñ–¥–±—É–≤—Å—è

**–ú–æ–¥–µ–ª—å:** `hr.hospital.visit`

```python
def write(self, vals):
    """
    –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–º—ñ–Ω–∏ –ª—ñ–∫–∞—Ä—è/–¥–∞—Ç–∏/—á–∞—Å—É –¥–ª—è –≤—ñ–∑–∏—Ç—ñ–≤
    —â–æ –≤–∂–µ –≤—ñ–¥–±—É–ª–∏—Å—å
    """
    for record in self:
        if record.status == 'completed':
            protected_fields = [
                'doctor_id', 'scheduled_date', 'patient_id'
            ]
            if any(field in vals for field in protected_fields):
                raise ValidationError(
                    _('Cannot change doctor, date or patient '
                      'for completed visits!')
                )
    return super().write(vals)
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- Override –º–µ—Ç–æ–¥—É write()
- –ó–∞—Ö–∏—â–∞—î 3 –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–ª—è: doctor, date, patient
- –¢—ñ–ª—å–∫–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –≤—ñ–∑–∏—Ç—ñ–≤ (status='completed')
- –ó–∞—Ö–∏—Å—Ç —ñ—Å—Ç–æ—Ä—ñ—ó –º–µ–¥–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤

---

## üìÅ –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

### Models (4):
1. ‚úÖ `models/hr_hospital_doctor.py`
   - +2 SQL constraints
   - +2 Python constrains

2. ‚úÖ `models/hr_hospital_doctor_schedule.py`
   - +1 SQL constraint

3. ‚úÖ `models/hr_hospital_visit.py`
   - +1 Python constrains (duplicate)
   - +1 write() override
   - +1 unlink() override

4. ‚úÖ `models/hr_hospital_patient.py`
   - +1 Python constrains (age)

5. ‚úÖ `models/hr_hospital_diagnosis.py`
   - +1 Python constrains (approval_date)

---

## ‚úÖ –õ—ñ–Ω—Ç—É–≤–∞–Ω–Ω—è

### Pylint: 10.00/10 ‚úÖ
```
Your code has been rated at 10.00/10
```

### Flake8: 0 –ø–æ–º–∏–ª–æ–∫ ‚úÖ
```
Exit code: 0
Output: 0
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- C0303: trailing-whitespace (3 –≤–∏–ø–∞–¥–∫–∏)
- W8120: translation-positional-used (1 –≤–∏–ø–∞–¥–æ–∫ - –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ named placeholders)
- E501: line too long (3 –≤–∏–ø–∞–¥–∫–∏ - —Ä–æ–∑–±–∏—Ç–æ –Ω–∞ –∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤)

---

## üéØ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∏–º–æ–≥–∞–º

### 5.1. SQL –æ–±–º–µ–∂–µ–Ω–Ω—è

| –í–∏–º–æ–≥–∞ | –ú–æ–¥–µ–ª—å | –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | Constraint |
|--------|--------|-------------|------------|
| –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å license_number | Doctor | ‚úÖ | UNIQUE |
| –†–µ–π—Ç–∏–Ω–≥ 0.00-5.00 | Doctor | ‚úÖ | CHECK |
| time_to > time_from | Schedule | ‚úÖ | CHECK |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3/3 = 100% ‚úÖ

---

### 5.2. Python –æ–±–º–µ–∂–µ–Ω–Ω—è

| –í–∏–º–æ–≥–∞ | –ú–æ–¥–µ–ª—å | –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | –ú–µ—Ç–æ–¥ |
|--------|--------|-------------|-------|
| –Ü–Ω—Ç–µ—Ä–Ω –Ω–µ –º–µ–Ω—Ç–æ—Ä | Doctor | ‚úÖ | @api.constrains |
| –ù–µ 2+ –≤—ñ–∑–∏—Ç–∏/–¥–µ–Ω—å | Visit | ‚úÖ | @api.constrains |
| –ù–µ –º–µ–Ω—Ç–æ—Ä —Å–æ–±—ñ | Doctor | ‚úÖ | @api.constrains |
| –î–∞—Ç–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è | Diagnosis | ‚úÖ | @api.constrains |
| –í—ñ–∫ > 0 | Patient | ‚úÖ | @api.constrains |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 5/5 = 100% ‚úÖ

---

### 5.3. –û–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó

| –í–∏–º–æ–≥–∞ | –ú–æ–¥–µ–ª—å | –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | –ú–µ—Ç–æ–¥ |
|--------|--------|-------------|-------|
| –ù–µ –≤–∏–¥–∞–ª—è—Ç–∏ –≤—ñ–∑–∏—Ç –∑ –¥—ñ–∞–≥–Ω–æ–∑–∞–º–∏ | Visit | ‚úÖ | unlink() |
| –ù–µ –∞—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏ –∑ –≤—ñ–∑–∏—Ç–∞–º–∏ | Doctor | ‚úÖ | @api.constrains |
| –ù–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ completed –≤—ñ–∑–∏—Ç | Visit | ‚úÖ | write() |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3/3 = 100% ‚úÖ

---

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:

1. ‚úÖ **SQL Constraints** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î
2. ‚úÖ **@api.constrains** - Python –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
3. ‚úÖ **Override unlink()** - –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è
4. ‚úÖ **Override write()** - –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
5. ‚úÖ **Complex domain** - —Å–∫–ª–∞–¥–Ω—ñ –ø–æ—à—É–∫–∏
6. ‚úÖ **Date manipulation** - —Ä–æ–±–æ—Ç–∞ –∑ –¥–∞—Ç–∞–º–∏
7. ‚úÖ **Named placeholders** - –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
8. ‚úÖ **Multi-field validation** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫—ñ–ª—å–∫–æ—Ö –ø–æ–ª—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

---

## üí° –ö–ª—é—á–æ–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è

### 1. SQL vs Python

**SQL Constraints:**
- ‚úÖ –®–≤–∏–¥—à–µ
- ‚úÖ –ù–∞–¥—ñ–π–Ω—ñ—à–µ (–Ω–µ–º–æ–∂–ª–∏–≤–æ –æ–±—ñ–π—Ç–∏)
- ‚úÖ –ú–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ Python

**Python Constrains:**
- ‚úÖ –ë—ñ–ª—å—à –≥–Ω—É—á–∫—ñ
- ‚úÖ –°–∫–ª–∞–¥–Ω—ñ—à–∞ –ª–æ–≥—ñ–∫–∞
- ‚úÖ –ö—Ä–∞—â—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –æ–±–∏–¥–≤–∞** –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å—É.

---

### 2. Duplicate Visit Check

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—ñ–∑–∏—Ç —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –≤ –º–µ–∂–∞—Ö –¥–Ω—è?

**–†—ñ—à–µ–Ω–Ω—è:**
```python
visit_date = fields.Date.to_date(record.scheduled_date)
domain = [
    ('scheduled_date', '>=', start_of_day),
    ('scheduled_date', '<', end_of_day),
    ('status', '!=', 'cancelled'),
]
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î Datetime ‚Üí Date
- –®—É–∫–∞—î –≤ –º–µ–∂–∞—Ö –¥–Ω—è (00:00 - 23:59)
- –Ü–≥–Ω–æ—Ä—É—î —Å–∫–∞—Å–æ–≤–∞–Ω—ñ –≤—ñ–∑–∏—Ç–∏

---

### 3. Completed Visit Protection

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ?

**–†—ñ—à–µ–Ω–Ω—è:**
```python
def write(self, vals):
    for record in self:
        if record.status == 'completed':
            if any(field in vals for field in protected_fields):
                raise ValidationError(...)
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- Override write() –∑–∞–º—ñ—Å—Ç—å constrains
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ
- –ó–∞—Ö–∏—â–∞—î 3 –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–ª—è

---

### 4. Archive with Visits

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫ –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤—Ç—Ä–∞—Ç—ñ –ª—ñ–∫–∞—Ä—è –ø–∞—Ü—ñ—î–Ω—Ç–∞–º–∏?

**–†—ñ—à–µ–Ω–Ω—è:**
```python
@api.constrains('active')
def _check_archive_with_active_visits(self):
    if not record.active:
        active_visits = search([
            ('scheduled_date', '>=', today),
        ])
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Ç—ñ–ª—å–∫–∏ –º–∞–π–±—É—Ç–Ω—ñ –≤—ñ–∑–∏—Ç–∏
- –ú–∏–Ω—É–ª—ñ –≤—ñ–∑–∏—Ç–∏ - OK (—ñ—Å—Ç–æ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è)
- –í–∏–º–∞–≥–∞—î —è–≤–Ω–∏—Ö –¥—ñ–π (–ø–µ—Ä–µ–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è)

---

### 5. Age Validation

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–∫ —è–∫—â–æ –≤—ñ–Ω computed?

**–†—ñ—à–µ–Ω–Ω—è:**
```python
@api.constrains('date_of_birth')
def _check_date_of_birth(self):
    if record.date_of_birth >= fields.Date.today():
        raise ValidationError(...)
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∏—Ö—ñ–¥–Ω–µ –ø–æ–ª–µ (date_of_birth)
- Age –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –ù–µ –º–æ–∂–µ –±—É—Ç–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω–∏–π —Å—å–æ–≥–æ–¥–Ω—ñ

---

## üìà –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: –î–æ vs –ü—ñ—Å–ª—è

### –ë–µ–∑–ø–µ–∫–∞ –¥–∞–Ω–∏—Ö

| –ê—Å–ø–µ–∫—Ç | –î–æ | –ü—ñ—Å–ª—è |
|--------|-----|-------|
| **SQL Constraints** | 0 | 3 ‚úÖ |
| **Python Constraints** | 2 | 7 (+5) ‚úÖ |
| **Override –º–µ—Ç–æ–¥—ñ–≤** | 1 | 3 (+2) ‚úÖ |
| **–ó–∞—Ö–∏—Å—Ç —ñ—Å—Ç–æ—Ä—ñ—ó** | ‚ùå | ‚úÖ |
| **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞—Ç** | –ë–∞–∑–æ–≤–∞ | –ü–æ–≤–Ω–∞ ‚úÖ |

### –ú–æ–¥–µ–ª—ñ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è–º–∏

| –ú–æ–¥–µ–ª—å | –î–æ | –ü—ñ—Å–ª—è |
|--------|-----|-------|
| **Doctor** | 2 constrains | 2 SQL + 3 Python |
| **Schedule** | 3 Python | 1 SQL + 3 Python |
| **Visit** | 2 Python | 2 Python + 2 override |
| **Patient** | 1 Python | 2 Python |
| **Diagnosis** | 0 | 1 Python |

---

## üîí –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö

### –©–æ –∑–∞—Ö–∏—â–µ–Ω–æ:

1. ‚úÖ **–£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å** - license_number (SQL)
2. ‚úÖ **–î—ñ–∞–ø–∞–∑–æ–Ω–∏** - rating 0-5 (SQL), age > 0 (Python)
3. ‚úÖ **–õ–æ–≥—ñ–∫–∞** - time_to > time_from (SQL)
4. ‚úÖ **–ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞** - intern not mentor (Python)
5. ‚úÖ **–î—É–±–ª—ñ–∫–∞—Ç–∏** - 1 visit/day (Python)
6. ‚úÖ **–Ü—Å—Ç–æ—Ä—ñ—è** - completed visits (write override)
7. ‚úÖ **–ú–µ–¥–∏—á–Ω—ñ –¥–∞–Ω—ñ** - visits with diagnoses (unlink override)
8. ‚úÖ **–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å** - archive with visits (Python)

---

## üöÄ –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤–∞ –¥–æ:
- ‚úÖ –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–º –¥–∞–Ω–∏–º
- ‚úÖ –ó–∞—Ö–∏—Å—Ç—É —ñ—Å—Ç–æ—Ä—ñ—ó –º–µ–¥–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- ‚úÖ –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏
- ‚úÖ –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º —É —Ä–æ–∑–∫–ª–∞–¥—ñ
- ‚úÖ –ó–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úÖ Production –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

---

## üìö –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:

1. **Phone Format Validation** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
2. **Email Validation** - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è email –∞–¥—Ä–µ—Å–∏
3. **Passport Format** - —Ñ–æ—Ä–º–∞—Ç –ø–∞—Å–ø–æ—Ä—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö
4. **License Expiry** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó –ª—ñ—Ü–µ–Ω–∑—ñ—ó
5. **Age Limits** - –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –≤—ñ–∫ –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤
6. **Schedule Conflicts** - –¥–µ—Ç–∞–ª—å–Ω—ñ—à–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:

1. **Contextual Messages** - –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
2. **Suggestions** - –ø—ñ–¥–∫–∞–∑–∫–∏ —è–∫ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É
3. **Multi-language** - –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤

### –õ–æ–≥—É–≤–∞–Ω–Ω—è:

1. **Validation Logs** - –∂—É—Ä–Ω–∞–ª —Å–ø—Ä–æ–± –ø–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª
2. **Audit Trail** - —Ö—Ç–æ —ñ –∫–æ–ª–∏ –Ω–∞–º–∞–≥–∞–≤—Å—è –∑–º—ñ–Ω–∏—Ç–∏ protected –¥–∞–Ω—ñ

---

## üéì –í–∏—Å–Ω–æ–≤–∫–∏

### –©–æ –¥–æ—Å—è–≥–Ω—É—Ç–æ:

1. **3 SQL Constraints** - —à–≤–∏–¥–∫—ñ —Ç–∞ –Ω–∞–¥—ñ–π–Ω—ñ
2. **5 Python Constraints** - –≥–Ω—É—á–∫—ñ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ñ
3. **2 Override –º–µ—Ç–æ–¥—ñ–≤** - –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–ø–µ—Ä–∞—Ü—ñ–π
4. **11 –≤–∞–ª—ñ–¥–∞—Ü—ñ–π** –∑–∞–≥–∞–ª–æ–º

### –ü—Ä–∏–Ω—Ü–∏–ø–∏:

‚úÖ **Defense in Depth** - –∫—ñ–ª—å–∫–∞ —Ä—ñ–≤–Ω—ñ–≤ –∑–∞—Ö–∏—Å—Ç—É  
‚úÖ **Fail Fast** - —Ä–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è  
‚úÖ **Clear Messages** - –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  
‚úÖ **Business Logic** - –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º  
‚úÖ **Data Integrity** - —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö

---

**–í–∏–∫–æ–Ω–∞–≤:** AI Assistant  
**–î–∞—Ç–∞:** 2025-11-10  
**–í–µ—Ä—Å—ñ—è –º–æ–¥—É–ª—è:** 17.0.2.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û (–ü—É–Ω–∫—Ç 5)
